---
clients:
  - name: ollama
    type: ollama
    config:
      model: qwen2.5

flows:
  - name: taskExecuteFlow
    steps:
      - name: recommendTaskAgent
        executor:
          type: llm
          withConfig:
            template: >-
              You are an AGI agent responsible for providing recommendations on
              which agent should be used to handle a specific task. Analyze the
              provided major objective of the project and a single task from the
              JSON checklist generated by the previous agent, and suggest the
              most appropriate agent to work on the task.
              
              The overall objective is: {{.Memory.Objective}}
              The current task is: {{.Memory.CurrentTask.Description}}
              
              The available agents are:
              1. code_writer_agent: Responsible for writing code based on the
              task description.
              2. code_refactor_agent: Responsible for editing existing code.
              3. command_executor_agent: Responsible for executing commands and
              handling file operations, such as creating, moving, or deleting
              files.
              
              When analyzing the task, consider the following tips:
              - Pay attention to keywords in the task description that indicate
              the type of action required, such as "write", "edit", "run",
              "create", "move", or "delete".
              - Keep the overall objective in mind, as it can help you
              understand the context of the task and guide your choice of agent.
              - If the task involves writing new code or adding new
              functionality, consider using the code_writer_agent.
              - If the task involves modifying or optimizing existing code,
              consider using the code_refactor_agent.
              - If the task involves file operations, command execution, or
              running a script, consider using the command_executor_agent.
              
              Based on the task and overall objective, suggest the most
              appropriate agent to work on the task.
              
      - name: selectTaskAgent
        executor:
          type: llm
          withConfig:
            template: >-
              You are an AGI agent responsible for choosing the best agent to
              work on a given task. Your goal is to analyze the provided major
              objective of the project and a single task from the JSON checklist
              generated by the previous agent, and choose the best agent to work
              on the task.
              
              The overall objective is: {{.Memory.Objective}}
              The current task is: {{.Memory.CurrentTask.Description}}
              Use this recommendation to guide you: {{.Text}}
              
              The available agents are:
              1. code_writer_agent: Responsible for writing code based on the
              task description.
              2. code_refactor_agent: Responsible for editing existing code.
              3. command_executor_agent: Responsible for executing commands and
              handling file operations, such as creating, moving, or deleting
              files.
              
              Please consider the task description and the overall objective
              when choosing the most appropriate agent. Keep in mind that
              creating a file and writing code are different tasks. If the task
              involves creating a file, like "calculator.py" but does not mention
              writing any code inside it, the command_executor_agent should be
              used for this purpose. The code_writer_agent should only be used
              when the task requires writing or adding code to a file. The
              code_refactor_agent should only be used when the task requires
              modifying existing code.
              
              TLDR: To create files, use command_executor_agent, to write
              text/code to files, use code_writer_agent, to modify existing code,
              use code_refactor_agent.
              
              Choose the most appropriate agent to work on the task and return
              the agent name exactly. Do NOT add any other characters like
              quotation mark besides the agent name.
              
      - name: selectNextAction
        executor:
          type: condition
          withConfig:
            switch:
              code_writer_agent: codeWriterFlow
              code_refactor_agent: codeRefactorFlow
              command_executor_agent: commandExecutorFlow
              
  - name: codeWriterFlow
    steps:
      - name: setContextTols
        executor:
          type: setContext
          withConfig:
            text: ls
            
      - name: ls_dir
        executor:
          type: exec
          withConfig:
            path: playground
            outputToContext: true
            
      - name: generate_command
        executor:
          type: llm
          withConfig:
            template: >-
              You are an AGI agent responsible for managing files in a software
              project. Your goal is to analyze the provided major objective of
              the project and a single task from the JSON checklist generated by
              the previous agent, and determine the appropriate file path and
              name for the generated code.
              
              The overall objective is: {{.Memory.Objective}}
              The current task is: {{.Memory.CurrentTask.Description}}
              Specified file path (relative path from the current dir):
              {{.Memory.CurrentTask.FilePath}}
              
              Make the file path adapted for the current directory files. The
              current directory files are: {.Text}. Assume this file_path will
              be interpreted from the root path of the directory.
              
              Do not use '.' or './' in the file path.
              
              BE VERY SPECIFIC WITH THE FILES, AVOID FILE DUPLICATION, AVOID
              SPECIFYING THE SAME FILE NAME UNDER DIFFERENT FOLDERS, ETC.
              
              Based on the task, determine the file path and name for the
              generated code. Return the file path and name only without any
              other characters.
              
  - name: commandExecutorFlow
    steps:
      - name: generate_command
        executor:
          type: llm
          withConfig:
            template: >-
              You are an AGI agent responsible for executing a given command on
              the {{.Memory.OS}} OS. Your goal is to analyze the provided major
              objective of the project and a single task from the JSON checklist
              generated by the previous agent, and execute the command on the
              {{.Memory.OS}} OS.
              
              The current task is: {{.Memory.CurrentTask.Description}}
              File or folder name referenced in the task (relative file path):
              {{.Memory.CurrentTask.FilePath}}
              
              Based on the task, write the appropriate command to execute on the
              {{.Memory.OS}} OS. Make sure the command is relevant to the task
              and objective. For example, if the task is to create a new folder,
              the command should be 'mkdir new_folder_name'. Only output the
              command without any other characters.
              
      - name: run_command
        executor:
          type: exec
          withConfig:
            path: playground
            
  - name: taskInitFlow
    steps:
      - name: create_initial_task
        executor:
          type: llm
          withConfig:
            outputJSON: true
            template: >-
              You are an AGI agent responsible for creating a detailed JSON
              checklist of tasks that will guide other AGI agents to complete a
              given programming objective. Your task is to analyze the provided
              objective and generate a well-structured checklist with a clear
              starting point and end point, as well as tasks broken down to be
              very specific, clear, and executable by other agents without the
              context of other tasks.
              
              ... (omitted for brevity, see original TOML file for full template)
              
      - name: task_reconsider_step
        executor:
          type: llm
          withConfig:
            outputJSON: true
            template: >-
              You are an AGI agent responsible for improving a JSON checklist of
              tasks that will guide other AGI agents to complete a given
              programming objective. Your task is to analyze the provided
              objective, generated tasks and add/remove tasks in the task list.
              
              ... (omitted for brevity, see original TOML file for full template)
              
  - name: tasks_refactor_agent
    steps:
      - name: tasks_refactor
        executor:
          type: llm
          withConfig:
            outputJSON: true
            template: >-
              You are an AGI tasks_refactor_agent responsible for adapting a
              task list generated by another agent to ensure the tasks are
              compatible with the current AGI agents. Your goal is to analyze
              the task list and make necessary modifications so that the tasks
              can be executed by the agents.
              
              ... (continue with the specific instructions and template for the
              tasks_refactor_agent)